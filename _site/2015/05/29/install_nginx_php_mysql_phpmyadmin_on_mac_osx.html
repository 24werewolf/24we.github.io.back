
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Mac OS上搭建LNMP开发环境</title>
    
    <meta name="author" content="温智全">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/twitter/css/prettify.css" rel="stylesheet" type="text/css">
    <script src="/assets/themes/twitter/js/prettify.js"></script>
    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

<!--    font-awesome-->
<link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

  </head>

  <body onload="prettyPrint()" >
    <div class="navbar">
      <div class="navbar-inner">
       <div class="nav-narrow">
          <a class="brand" href="/"><span class="fa fa-mortar-board (alias)">wenknows's blog</span></a>
          <ul class="nav">
            
            
            


  
    
      
      	
      	<li><a href="/archive">文章</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories">分类</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages">页面</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags">标签</a></li>
      	
      
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container-narrow">

      <div class="content">
        
<!--
<div class="page-header">
  <h1>Mac OS上搭建LNMP开发环境 <small>Supporting tagline</small></h1>
</div>
-->
 

<div class="row-fluid post-full">
  <div class="span12 ">
    <div class="content card">
        <div class="date_label">
          <div class="day_month">
          05/29
          </div>
          <div class="year">
          2015
          </div>
        </div>
      <h1>Mac OS上搭建LNMP开发环境</h1>

<hr />

<h3>1. 概述</h3>

<p>LNMP代表的就是：Linux系统下Nginx+MySQL+PHP这种网站服务器架构。Linux是一类Unix计算机操作系统的统称，是目前最流行的免费操作系统。代表版本有：debian、centos、ubuntu、fedora、gentoo等。<a href="http://nginx.org/">Nginx</a>是一个高性能的HTTP和反向代理服务器，也是一个IMAP/POP3/SMTP代理服务器。<a href="http://www.mysql.com/">Mysql</a>是一个小型关系型数据库管理系统。<a href="http://php.net/">PHP</a>是一种在服务器端执行的嵌入HTML文档的脚本语言。这四种软件均为免费开源软件，组合到一起，成为一个免费、高效、扩展性强的网站服务系统。</p>

<h3>2. 安装Homebrew</h3>

<p>使用Mac的程序员必不可少的一步便是安装Homebrew，他就像是centOS的<code>yum</code>命令和ubuntu的<code>apt-get</code>命令一样，通过<code>brew</code>命令，我们可以快速的安装一些软件包。
使用命令行安装Homebrew的命令如下：</p>

<pre><code>ruby -e "$(curl -fsSL https://raw.github.com/mxcl/homebrew/go)"
</code></pre>

<p>使用<code>brew doctor</code>检查是否存在冲突，然后使用<code>brew update &amp;&amp; brew upgrade</code>对brew进行升级。</p>

<!--break-->


<h3>3. 安装nginx</h3>

<p>nginx在Mac OS中可以直接使用brew命令进行安装：</p>

<pre><code>brew install nginx
</code></pre>

<p>如果需要使用80端口的话，需要将nginx加入root组当中：</p>

<pre><code>sudo cp -v /usr/local/opt/nginx/*.plist /Library/LaunchDaemons/
sudo chown root:wheel /Library/LaunchDaemons/homebrew.mxcl.nginx.plist
</code></pre>

<p>然后使用命令启动nginx服务：</p>

<pre><code>sudo nginx
</code></pre>

<p>测试nginx是否安装成功，因为默认配置文件监听的是<code>8080</code>端口，所以先对<code>8080</code>端口发起请求：</p>

<pre><code>curl -IL http://127.0.0.1:8080
</code></pre>

<p>结果应该类似于下：</p>

<pre><code>HTTP/1.1 200 OK
Server: nginx/1.9.1
Date: Fri, 29 May 2015 14:50:47 GMT
Content-Type: text/html
Content-Length: 612
Last-Modified: Fri, 29 May 2015 14:40:47 GMT
Connection: keep-alive
ETag: "5444dea7-264"
Accept-Ranges: bytes
</code></pre>

<p>nginx的相关操作如下：</p>

<pre><code>sudo nginx //启动nginx
sudo nginx -s reload|reopen|quit //重新加载|重启|退出
</code></pre>

<h3>4. 安装php-fpm</h3>

<p>因为brew并没有php-fpm的源，所以首先要添加源：</p>

<pre><code>brew tap homebrew/dupes
brew tap homebrew/php
</code></pre>

<p>然后安装php-fpm，输入命令:</p>

<pre><code>brew install php56 --whitout-apache --with-imap --with-tidy --with-debug --with-pgsql --with-mysql --with-fpm
</code></pre>

<p>程序会自动安装，等待几分钟后完成安装。</p>

<p>安装完成后，还需要将php加入<code>$PATH</code>当中：</p>

<pre><code># 如果使用bash的话
vim ~/.bash_profile
export PATH="/usr/local/sbin:$PATH"
source ~/.bash_profile

# 如果使用ZSH的话
vim ~/.zshrc
export PATH="/usr/local/sbin:$PATH"
source ~/.zshrc
</code></pre>

<p>然后可以设置php-fpm的开机自启动：</p>

<pre><code>mkdir -p ~/Library/LaunchAgents
ln -sfv /usr/local/opt/php56/homebrew.mxcl.php56.plist ~/Library/LaunchAgents/
launchctl load -w ~/Library/LaunchAgents/homebrew.mxcl.php56.plist
</code></pre>

<p>使用以下命令监测php-fpm是否启动成功：</p>

<pre><code>lsof -Pni4 | grep LISTEN | grep php
</code></pre>

<p>如果启动成功应当有以下类似输出：</p>

<pre><code>php-fpm   27578 wenzhiquan    9u  IPv4 0xf29f8b26c08fc27      0t0  TCP 127.0.0.1:9000 (LISTEN)
php-fpm   27628 wenzhiquan    0u  IPv4 0xf29f8b26c08fc27      0t0  TCP 127.0.0.1:9000 (LISTEN)
php-fpm   27629 wenzhiquan    0u  IPv4 0xf29f8b26c08fc27      0t0  TCP 127.0.0.1:9000 (LISTEN)
php-fpm   27630 wenzhiquan    0u  IPv4 0xf29f8b26c08fc27      0t0  TCP 127.0.0.1:9000 (LISTEN)
</code></pre>

<h3>5. 安装MySQL</h3>

<p>MySQL也可以使用brew命令直接进行安装：</p>

<pre><code>brew install mysql
</code></pre>

<p>同样，可以设置MySQL的开机自启动：</p>

<pre><code>ln -sfv /usr/local/opt/mysql/*.plist ~/Library/LaunchAgents
launchctl load ~/Library/LaunchAgents/homebrew.mxcl.mysql.plist
</code></pre>

<p>然后进行MySQL的安全安装，使用以下命令，可以更改root密码、删除匿名用户、关闭远程连接等：</p>

<pre><code>mysql_secure_installation
</code></pre>

<p>然后会输出以下内容：</p>

<pre><code>&gt; Enter current password for root (enter for none):     //默认没有密码，直接回车即可
&gt; Change the root password? [Y/n]                       //是否更改root密码，选择是，然后输入并确认密码
&gt; Remove anonymous users? [Y/n]                         //是否删除匿名用户，选择是
&gt; Disallow root login remotely? [Y/n]                   //是否禁止远程登录，选择是
&gt; Remove test database and access to it? [Y/n]          //是否删除test数据库，选择是
&gt; Reload privilege tables now? [Y/n]                    //是否重载表格数据，选择是
</code></pre>

<p>测试数据库是否安装成功：</p>

<pre><code>mysql -u root -p
</code></pre>

<p>然后输入刚才设置的root密码，将会输出以下内容：</p>

<pre><code>Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt; exit         //输入exit退出数据库
</code></pre>

<h3>6. 配置nginx</h3>

<p>首先，为我们的配置文件创建一些文件夹，这些是仿照ubuntu的nginx结构进行建立的目录：</p>

<pre><code>mkdir -p /usr/local/etc/nginx/logs
mkdir -p /usr/local/etc/nginx/sites-available
mkdir -p /usr/local/etc/nginx/sites-enabled
mkdir -p /usr/local/etc/nginx/conf.d
mkdir -p /usr/local/etc/nginx/ssl

sudo mkdir -p /var/www
sudo chown :staff /var/www
sudo chmod 775 /var/www
</code></pre>

<p>然后修改nginx配置文件：</p>

<pre><code>vim /usr/local/etc/nginx/nginx.conf
</code></pre>

<p>将内容替换为：</p>

<pre><code>worker_processes  1;

error_log  /usr/local/etc/nginx/logs/error.log debug;

events {
    worker_connections  1024;
}

http {
    include             mime.types;
    default_type        application/octet-stream;

    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    access_log  /usr/local/etc/nginx/logs/access.log  main;

    sendfile            on;

    keepalive_timeout   65;

    index index.html index.php;

    include /usr/local/etc/nginx/sites-enabled/*;
}
</code></pre>

<p>然后创建php-fpm配置文件：</p>

<pre><code>vim /usr/local/ect/nginx/conf.d/php-fpm
</code></pre>

<p>输入以下内容：</p>

<pre><code>location ~ \.php$ {
    try_files      $uri = 404;
    fastcgi_pass   127.0.0.1:9000;
    fastcgi_index  index.php;
    fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;
    include        fastcgi_params;
}
</code></pre>

<p>然后加入站点配置文件：</p>

<pre><code>vim /usr/local/ect/nginx/sites-enabled/default
</code></pre>

<p>输入以下内容：</p>

<pre><code>server {
    listen       80;
    server_name  localhost;
    root       /var/www/;

    access_log  /usr/local/etc/nginx/logs/default.access.log  main;

    location / {
        include   /usr/local/etc/nginx/conf.d/php-fpm;
    }

    location = /info {
        allow   127.0.0.1;
        deny    all;
        rewrite (.*) /.info.php;
    }

    error_page  404     /404.html;
    error_page  403     /403.html;
}
</code></pre>

<p>重启nginx，至此，配置完成，在www下写一个测试文件，进行测试即可</p>

<h4>尽情的享受在Mac OS开发PHP的快感吧！</h4>

    </div>

 
<!--
    <ul class="tag_box inline ">
      <li><i class="icon-folder-open"></i></li>
      
      


  
     
    	<li><a href="/categories.html#Mac OS-ref">
    		Mac OS <span>3</span>
    	</a></li>
    
  


    </ul>
    

  
    <ul class="tag_box inline ">
      <li><i class="icon-tags"></i></li>
      
      


  
     
    	<li><a href="/tags.html#Mac OS-ref">Mac OS <span>3</span></a></li>
     
    	<li><a href="/tags.html#PHP-ref">PHP <span>2</span></a></li>
    
  



    </ul>
    -->
    
    <div class="pagination clearfix">
      <ul class = "pull-right">
      
        <li class="prev"><a class="fa fa-arrow-circle-left" href="/2015/05/19/leetcode_26_easy_remove_duplicates_from_sorted_array" title="leetcode easy remove_duplicates_from_sorted_array"> 前一篇</a></li>
      
        <li><a class="fa fa-th" href="/archive.html"> 所有日志</a></li>
      
        <li class="next"><a  href="/2015/09/18/install_jekyll_on_fedora_22" title="Fedora 22上安装jekyll">后一篇 <span class="fa fa-arrow-circle-right">  </span></a></li>
      
      </ul>
    </div>
    
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'wenzhiquan'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




  </div>
</div>


      </div>

      <footer class="card clearfix">
        <span style="font-size:30px;"class="fa fa-github pull-left"></span><a href="https://github.com/wenzhiquan/blog" style="display:inline-block;padding-right:80px;border-right:1px solid #bbb">fork me on GitHub</a>
        <p class="pull-right">&copy; 2014 温智全
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>

      </footer>

    </div>

    
  </body>
</html>

